# React å®˜æ–¹æ–‡æ¡£

## React å“²å­¦

- props åƒæ˜¯ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°ï¼Œstate åƒæ˜¯ç»„ä»¶çš„å†…å­˜ [ğŸ”—](https://react.docschina.org/learn/thinking-in-react#props-vs-state)
- å“ªäº›æ˜¯ stateï¼Ÿ [ğŸ”—](https://react.docschina.org/learn/thinking-in-react#step-3-find-the-minimal-but-complete-representation-of-ui-state)
  - éšç€äº‹ä»¶æ¨ç§»**ä¿æŒä¸å˜**ï¼Ÿ
  - é€šè¿‡ props **ä»çˆ¶ç»„ä»¶ä¼ é€’**ï¼Ÿ
  - æ˜¯å¦å¯ä»¥åŸºäºå·²å­˜åœ¨ä¸ç»„ä»¶ä¸­çš„ state æˆ–è€… props è¿›è¡Œ**è®¡ç®—**ï¼Ÿ

## æè¿° UI

- ç»„ä»¶åç§°å¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´
- ä¸‡ç‰©çš†ç»„ä»¶ï¼›[ğŸ”—](https://react.docschina.org/learn/your-first-component#components-all-the-way-down)
- ä¸è¦åµŒå¥—ç»„ä»¶çš„å®šä¹‰ [ğŸ”—](https://react.docschina.org/learn/your-first-component#nesting-and-organizing-components)
- é»˜è®¤å¯¼å‡ºè¿˜æ˜¯å…·åå¯¼å‡º? [ğŸ”—](https://react.docschina.org/learn/importing-and-exporting-components#default-vs-named-exports)

### JSX è§„åˆ™ [ğŸ”—](https://react.docschina.org/learn/writing-markup-with-jsx#the-rules-of-jsx)

- åªèƒ½è¿”å›ä¸€ä¸ªæ ¹å…ƒç´ 
- æ ‡ç­¾å¿…é¡»é—­åˆ
- ä½¿ç”¨é©¼å³°å¼å‘½åæ³•ç»™å±æ€§å‘½å

### JSX ä¸­ä½¿ç”¨ JavaScript

- JSX å¼•å·å†…çš„å€¼ä¼šä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’ç»™å±æ€§
- å¤§æ‹¬å·è®©ä½ å¯ä»¥å°† JavaScript çš„é€»è¾‘å’Œå˜é‡å¸¦å…¥åˆ°æ ‡ç­¾ä¸­[ğŸ”—](https://react.docschina.org/learn/javascript-in-jsx-with-curly-braces#using-curly-braces-a-window-into-the-javascript-world)
- å®ƒä»¬ä¼šåœ¨ JSX æ ‡ç­¾ä¸­çš„å†…å®¹åŒºåŸŸæˆ–ç´§éšå±æ€§çš„ `=` åèµ·ä½œç”¨
- `{{ }}` å¹¶ä¸æ˜¯ä»€ä¹ˆç‰¹æ®Šçš„è¯­æ³•ï¼šå®ƒåªæ˜¯åŒ…åœ¨ JSX å¤§æ‹¬å·å†…çš„ JavaScript å¯¹è±¡ã€‚[ğŸ”—](https://react.docschina.org/learn/javascript-in-jsx-with-curly-braces#using-double-curlies-css-and-other-objects-in-jsx)

### å°† props ä¼ é€’ç»™ç»„ä»¶ [ğŸ”—](https://react.docschina.org/learn/passing-props-to-a-component)

- å±æ€§ä¼ é€’ä»»ä½• JavaScript å€¼ï¼ŒåŒ…æ‹¬å¯¹è±¡ã€æ•°ç»„å’Œå‡½æ•°ã€‚
- props æ˜¯ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ï¼Œä¸è¦å°è¯•ä¿®æ”¹ propsï¼›
- Props æ˜¯åªè¯»çš„æ—¶é—´å¿«ç…§ï¼šæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ”¶åˆ°æ–°ç‰ˆæœ¬çš„ propsã€‚

### æ¸²æŸ“åˆ—è¡¨ [ğŸ”—](https://react.docschina.org/learn/rendering-lists)

- ç”¨ `key` ä¿æŒåˆ—è¡¨é¡¹çš„é¡ºåºï¼›
- åˆ—è¡¨è¿”å›å¤šä¸ªèŠ‚ç‚¹ï¼Œä½¿ç”¨ `Fragment` åŒ…è£¹ [ğŸ”—](https://react.docschina.org/learn/rendering-lists#displaying-several-dom-nodes-for-each-list-item)
- ä¸ºä½•ä»¥åŠå¦‚ä½•ç»™é›†åˆä¸­çš„æ¯ä¸ªç»„ä»¶è®¾ç½®ä¸€ä¸ª key å€¼ï¼šå®ƒä½¿ React èƒ½è¿½è¸ªè¿™äº›ç»„ä»¶ï¼Œå³ä¾¿åè€…çš„ä½ç½®æˆ–æ•°æ®å‘ç”Ÿäº†å˜åŒ–ã€‚

### ä¿æŒç»„ä»¶çº¯ç²¹ [ğŸ”—](https://react.docschina.org/learn/keeping-components-pure)

- ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼æ£€æµ‹ä¸çº¯çš„è®¡ç®—
  - åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å¼€å‘æ—¶ï¼Œå®ƒå°†ä¼šè°ƒç”¨æ¯ä¸ªç»„ä»¶å‡½æ•°ä¸¤æ¬¡ã€‚é€šè¿‡é‡å¤è°ƒç”¨ç»„ä»¶å‡½æ•°ï¼Œä¸¥æ ¼æ¨¡å¼æœ‰åŠ©äºæ‰¾åˆ°è¿åè¿™äº›è§„åˆ™çš„ç»„ä»¶ã€‚
- ä¸€ä¸ªç»„ä»¶å¿…é¡»æ˜¯çº¯ç²¹çš„ï¼Œå°±æ„å‘³ç€ï¼š
  - åªè´Ÿè´£è‡ªå·±çš„ä»»åŠ¡ã€‚ å®ƒä¸ä¼šæ›´æ”¹åœ¨è¯¥å‡½æ•°è°ƒç”¨å‰å°±å·²å­˜åœ¨çš„å¯¹è±¡æˆ–å˜é‡ã€‚
  - è¾“å…¥ç›¸åŒï¼Œåˆ™è¾“å‡ºç›¸åŒã€‚ ç»™å®šç›¸åŒçš„è¾“å…¥ï¼Œç»„ä»¶åº”è¯¥æ€»æ˜¯è¿”å›ç›¸åŒçš„ JSXã€‚
- æ¸²æŸ“éšæ—¶å¯èƒ½å‘ç”Ÿï¼Œå› æ­¤ç»„ä»¶ä¸åº”ä¾èµ–äºå½¼æ­¤çš„æ¸²æŸ“é¡ºåºã€‚
- ä½ ä¸åº”è¯¥æ”¹å˜ä»»ä½•ç”¨äºç»„ä»¶æ¸²æŸ“çš„è¾“å…¥ã€‚è¿™åŒ…æ‹¬ propsã€state å’Œ contextã€‚é€šè¿‡ â€œè®¾ç½®â€ state æ¥æ›´æ–°ç•Œé¢ï¼Œè€Œä¸è¦æ”¹å˜é¢„å…ˆå­˜åœ¨çš„å¯¹è±¡ã€‚
- åŠªåŠ›åœ¨ä½ è¿”å›çš„ JSX ä¸­è¡¨è¾¾ä½ çš„ç»„ä»¶é€»è¾‘ã€‚å½“ä½ éœ€è¦â€œæ”¹å˜äº‹ç‰©â€æ—¶ï¼Œä½ é€šå¸¸å¸Œæœ›åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­è¿›è¡Œã€‚ä½œä¸ºæœ€åçš„æ‰‹æ®µï¼Œä½ å¯ä»¥ä½¿ç”¨ useEffectã€‚

### å°† UI è§†ä¸ºæ ‘

- æ ‘æ˜¯è¡¨ç¤ºå®ä½“ä¹‹é—´å…³ç³»çš„å¸¸è§æ–¹å¼ï¼Œå®ƒä»¬ç»å¸¸ç”¨äºå»ºæ¨¡ UIï¼Œ
- æ¸²æŸ“æ ‘è¡¨ç¤ºå•æ¬¡æ¸²æŸ“ä¸­ React ç»„ä»¶ä¹‹é—´çš„åµŒå¥—å…³ç³»
- ä½¿ç”¨æ¡ä»¶æ¸²æŸ“ï¼Œæ¸²æŸ“æ ‘å¯èƒ½ä¼šåœ¨ä¸åŒçš„æ¸²æŸ“è¿‡ç¨‹ä¸­å‘ç”Ÿå˜åŒ–ã€‚ä½¿ç”¨ä¸åŒçš„å±æ€§å€¼ï¼Œç»„ä»¶å¯èƒ½ä¼šæ¸²æŸ“ä¸åŒçš„å­ç»„ä»¶
- æ¸²æŸ“æ ‘æœ‰åŠ©äºæ˜¯è¢«é¡¶çº§ç»„ä»¶å’Œå¶å­ç»„ä»¶ã€‚é¡¶çº§ç»„ä»¶ä¼šå½±å“å…¶ä¸‹æ‰€æœ‰ç»„ä»¶çš„æ¸²æŸ“æ€§èƒ½ï¼Œè€Œå¶å­ç»„ä»¶é€šå¸¸ä¼šé¢‘ç¹é‡æ–°æ¸²æŸ“ã€‚è¯†åˆ«å®ƒä»¬æœ‰åŠ©äºç†è§£å’Œè°ƒè¯•æ¸²æŸ“æ€§èƒ½é—®é¢˜

## æ·»åŠ äº¤äº’

### å“åº”äº‹ä»¶

- äº‹ä»¶å¤„ç†å‡½æ•°æ˜¯æ‰§è¡Œå‰¯ä½œç”¨çš„æœ€ä½³ä½ç½®ï¼Œä¸æ¸²æŸ“å‡½æ•°ä¸åŒï¼Œäº‹ä»¶å¤„ç†å‡½æ•°ä¸éœ€è¦æ˜¯çº¯å‡½æ•°ï¼Œå®ƒæ˜¯æ›´æ”¹æŸäº›å€¼çš„ç»ä½³ä½ç½®
- äº‹ä»¶å¤„ç†å‡½æ•°åœ¨ç»„ä»¶å†…éƒ¨å®šä¹‰ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥è®¿é—® propsã€‚
- ä½ å¯ä»¥åœ¨çˆ¶ç»„ä»¶ä¸­å®šä¹‰ä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå¹¶å°†å…¶ä½œä¸º prop ä¼ é€’ç»™å­ç»„ä»¶ã€‚

### state: ç»„ä»¶çš„è®°å¿† [ğŸ”—](https://react.docschina.org/learn/state-a-components-memory)

- æ™®é€šçš„å˜é‡æ— æ³•æ»¡è¶³æ—¶[ğŸ”—](https://react.docschina.org/learn/state-a-components-memory#when-a-regular-variable-isnt-enough)
  - ä¸ºä»€ä¹ˆå­˜åœ¨ stateï¼š
    - å±€éƒ¨å˜é‡æ— æ³•åœ¨å¤šæ¬¡æ¸²æŸ“ä¸­æŒä¹…ä¿å­˜
    - æ›´æ”¹å±€éƒ¨å˜é‡ä¸ä¼šè§¦å‘æ¸²æŸ“ã€‚
  - ä½¿ç”¨æ–°æ•°æ®æ›´æ–°ç»„ä»¶å‰æï¼š
    - **ä¿ç•™** æ¸²æŸ“ä¹‹å‰çš„æ•°æ®ã€‚
    - **è§¦å‘** React ä½¿ç”¨æ–°æ•°æ®æ¸²æŸ“ç»„ä»¶ï¼ˆé‡æ–°æ¸²æŸ“ï¼‰
  - `useState` ä½œç”¨
    - **State å˜é‡** ç”¨äºä¿å­˜æ¸²æŸ“é—´çš„æ•°æ®ã€‚
    - **State setter å‡½æ•°** æ›´æ–°å˜é‡å¹¶è§¦å‘ React å†æ¬¡æ¸²æŸ“ç»„ä»¶
- State æ˜¯éš”ç¦»ä¸”ç§æœ‰çš„ [ğŸ”—](https://react.docschina.org/learn/state-a-components-memory#state-is-isolated-and-private)
  - å¦‚æœä½ æ¸²æŸ“åŒä¸€ä¸ªç»„ä»¶ä¸¤æ¬¡ï¼Œæ¯ä¸ªå‰¯æœ¬éƒ½ä¼šæœ‰å®Œå…¨éš”ç¦»çš„ state
  - state å®Œå…¨ç§æœ‰äºå£°æ˜å®ƒçš„ç»„ä»¶

### æ¸²æŸ“å’Œæäº¤ [ğŸ”—](https://react.docschina.org/learn/render-and-commit)

- æ­¥éª¤
  1. è§¦å‘ä¸€æ¬¡æ¸²æŸ“
     - ç»„ä»¶çš„åˆæ¬¡æ¸²æŸ“
     - ç»„ä»¶ï¼ˆæˆ–è€…å…¶ç¥–å…ˆä¹‹ä¸€ï¼‰çš„çŠ¶æ€å‘ç”Ÿäº†æ”¹å˜
  2. æ¸²æŸ“ç»„ä»¶ ï¼ˆè°ƒç”¨å‡½æ•°ï¼‰
     - åœ¨è¿›è¡Œåˆæ¬¡æ¸²æŸ“æ—¶, React ä¼šè°ƒç”¨æ ¹ç»„ä»¶ã€‚
     - å¯¹äºåç»­çš„æ¸²æŸ“, React ä¼šè°ƒç”¨å†…éƒ¨çŠ¶æ€æ›´æ–°è§¦å‘äº†æ¸²æŸ“çš„å‡½æ•°ç»„ä»¶ã€‚
  3. æäº¤åˆ° DOM
     - å¯¹äºåˆæ¬¡æ¸²æŸ“ï¼Œ React ä¼šä½¿ç”¨ `appendChild()` DOM API å°†å…¶åˆ›å»ºçš„æ‰€æœ‰ DOM èŠ‚ç‚¹æ”¾åœ¨å±å¹•ä¸Šã€‚
     - å¯¹äºé‡æ¸²æŸ“ï¼Œ React å°†åº”ç”¨æœ€å°‘çš„å¿…è¦æ“ä½œï¼ˆåœ¨æ¸²æŸ“æ—¶è®¡ç®—ï¼ï¼‰ï¼Œä»¥ä½¿å¾— DOM ä¸æœ€æ–°çš„æ¸²æŸ“è¾“å‡ºç›¸äº’åŒ¹é…ã€‚
- React ä»…åœ¨æ¸²æŸ“ä¹‹é—´å­˜åœ¨å·®å¼‚æ—¶æ‰ä¼šæ›´æ”¹ DOM èŠ‚ç‚¹ï¼Œå¦‚æœæ¸²æŸ“ç»“æœä¸ä¸Šæ¬¡ä¸€æ ·ï¼Œé‚£ä¹ˆ React å°†ä¸ä¼šä¿®æ”¹ DOM
- åœ¨æ¸²æŸ“å®Œæˆï¼Œå¹¶ä¸” React æ›´æ–° DOM ä¹‹åï¼Œæµè§ˆå™¨å°±ä¼šé‡æ–°ç»˜åˆ¶å±å¹•

### state å¦‚åŒä¸€å¼ å¿«ç…§ [ğŸ”—](https://react.docschina.org/learn/state-as-a-snapshot)

- è®¾ç½® state è¯·æ±‚ä¸€æ¬¡æ–°çš„æ¸²æŸ“ã€‚
- æ­£åœ¨æ¸²æŸ“æ„å‘³ç€ React æ­£åœ¨è°ƒç”¨ä½ çš„ç»„ä»¶ï¼ˆä¸€ä¸ªå‡½æ•°ï¼‰ï¼Œå½“ React é‡æ–°æ¸²æŸ“ä¸€ä¸ªç»„ä»¶æ—¶ï¼š
  1. React ä¼šå†æ¬¡è°ƒç”¨ä½ çš„å‡½æ•°
  2. å‡½æ•°è¿”å›æ–°çš„ JSX å¿«ç…§ã€‚ï¼ˆè®¡ç®—å¿«ç…§ï¼‰
  3. React ä¼šæ›´æ–°ç•Œé¢ä»¥åŒ¹é…è¿”å›çš„å¿«ç…§
- React å°† state å­˜å‚¨åœ¨ç»„ä»¶ä¹‹å¤–ï¼Œå°±åƒåœ¨æ¶å­ä¸Šä¸€æ ·ã€‚
- è®¾ç½® state åªä¼šä¸ºä¸‹ä¸€æ¬¡æ¸²æŸ“å˜æ›´ state çš„å€¼
- ä¸€ä¸ª state å˜é‡çš„å€¼æ°¸è¿œä¸ä¼šåœ¨ä¸€æ¬¡æ¸²æŸ“çš„å†…éƒ¨å‘ç”Ÿå˜åŒ–
- React ä¼šä½¿ state çš„å€¼å§‹ç»ˆâ€å›ºå®šâ€œåœ¨ä¸€æ¬¡æ¸²æŸ“çš„å„ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨ã€‚
- å½“ä½ è°ƒç”¨ `useState` æ—¶ï¼ŒReact ä¼šä¸ºä½ æä¾›è¯¥æ¬¡æ¸²æŸ“ çš„ä¸€å¼  state å¿«ç…§ã€‚
- å˜é‡å’Œäº‹ä»¶å¤„ç†å‡½æ•°ä¸ä¼šåœ¨é‡æ¸²æŸ“ä¸­â€œå­˜æ´»â€ã€‚æ¯ä¸ªæ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„äº‹ä»¶å¤„ç†å‡½æ•°ã€‚
- æ¯ä¸ªæ¸²æŸ“ï¼ˆä»¥åŠå…¶ä¸­çš„å‡½æ•°ï¼‰å§‹ç»ˆâ€œçœ‹åˆ°â€çš„æ˜¯ React æä¾›ç»™è¿™ä¸ª æ¸²æŸ“çš„ state å¿«ç…§ã€‚
- ä½ å¯ä»¥åœ¨å¿ƒä¸­æ›¿æ¢äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„ stateï¼Œç±»ä¼¼äºæ›¿æ¢æ¸²æŸ“çš„ JSXã€‚
- è¿‡å»åˆ›å»ºçš„äº‹ä»¶å¤„ç†å‡½æ•°æ‹¥æœ‰çš„æ˜¯åˆ›å»ºå®ƒä»¬çš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„ state å€¼ã€‚

### æŠŠä¸€ç³»åˆ— state æ›´æ–°åŠ å…¥é˜Ÿåˆ— [ğŸ”—](https://react.docschina.org/learn/queueing-a-series-of-state-updates)

- React ä¼šå¯¹ state æ›´æ–°è¿›è¡Œæ‰¹å¤„ç†
- React ä¼šåœ¨äº‹ä»¶å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæˆä¹‹åå¤„ç† state æ›´æ–°ã€‚è¿™è¢«ç§°ä¸ºæ‰¹å¤„ç†ã€‚
- React ä¼šç­‰åˆ°äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„æ‰€æœ‰ä»£ç éƒ½è¿è¡Œå®Œæ¯•å†å¤„ç†ä½ çš„ state æ›´æ–°ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆé‡æ–°æ¸²æŸ“åªä¼šå‘ç”Ÿåœ¨æ‰€æœ‰è¿™äº› `setState` è°ƒç”¨ ä¹‹å çš„åŸå› ã€‚
- è®¾ç½® state ä¸ä¼šæ›´æ”¹ç°æœ‰æ¸²æŸ“ä¸­çš„å˜é‡ï¼Œä½†ä¼šè¯·æ±‚ä¸€æ¬¡æ–°çš„æ¸²æŸ“ã€‚
- è¦åœ¨ä¸€ä¸ªäº‹ä»¶ä¸­å¤šæ¬¡æ›´æ–°æŸäº› stateï¼Œä½ å¯ä»¥ä½¿ç”¨ setNumber(n => n + 1) æ›´æ–°å‡½æ•°ã€‚

### æ›´æ–° state ä¸­çš„å¯¹è±¡

- å°† React ä¸­æ‰€æœ‰çš„ state éƒ½è§†ä¸ºä¸å¯ç›´æ¥ä¿®æ”¹çš„ã€‚
- å½“ä½ åœ¨ state ä¸­å­˜æ”¾å¯¹è±¡æ—¶ï¼Œç›´æ¥ä¿®æ”¹å¯¹è±¡å¹¶ä¸ä¼šè§¦å‘é‡æ¸²æŸ“ï¼Œå¹¶ä¼šæ”¹å˜å‰ä¸€æ¬¡æ¸²æŸ“â€œå¿«ç…§â€ä¸­ state çš„å€¼ã€‚
- ä¸è¦ç›´æ¥ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œè¦ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œå¹¶é€šè¿‡æŠŠ state è®¾ç½®æˆè¿™ä¸ªæ–°ç‰ˆæœ¬æ¥è§¦å‘é‡æ–°æ¸²æŸ“ã€‚
- æƒ³è¦å‡å°‘é‡å¤çš„æ‹·è´ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨ Immerã€‚

## çŠ¶æ€ç®¡ç†

### ä½¿ç”¨ state å“åº”è¾“å…¥

- åˆ é™¤ä»»ä½•ä¸å¿…è¦çš„ state å˜é‡
  - è¿™ä¸ª state æ˜¯å¦ä¼šå¯¼è‡´çŸ›ç›¾ï¼Ÿ
  - ç›¸åŒçš„ä¿¡æ¯æ˜¯å¦å·²ç»åœ¨å¦å¤–ä¸€ä¸ª state å˜é‡ä¸­å­˜åœ¨
  - ä½ æ˜¯å¦å¯ä»¥é€šè¿‡å¦å¤–ä¸€ä¸ª state å˜é‡ä¸­çš„ç›¸åå€¼å¾—åˆ°ç›¸åŒçš„ä¿¡æ¯

### é€‰æ‹© State ç»“æ„

- æ„å»º state çš„åŸåˆ™
  - åˆå¹¶å…³è”çš„ state
  - é¿å…äº’ç›¸çŸ›ç›¾çš„ state
  - é¿å…å†—ä½™çš„ state
  - é¿å…é‡å¤çš„ state
  - é¿å…æ·±åº¦åµŒå¥—çš„ state
- é¿å…å†—ä½™å’Œé‡å¤çš„ stateï¼Œè¿™æ ·æ‚¨å°±ä¸éœ€è¦ä¿æŒåŒæ­¥ã€‚
- é™¤éæ‚¨ç‰¹åˆ«æƒ³é˜²æ­¢æ›´æ–°ï¼Œå¦åˆ™ä¸è¦å°† props æ”¾å…¥ state ä¸­ã€‚

### ç»„ä»¶é—´å…±äº«çŠ¶æ€

- å½“ä½ æƒ³è¦æ•´åˆä¸¤ä¸ªç»„ä»¶æ—¶ï¼Œå°†å®ƒä»¬çš„ state ç§»åŠ¨åˆ°å…±åŒçš„çˆ¶ç»„ä»¶ä¸­ã€‚
- ç„¶ååœ¨çˆ¶ç»„ä»¶ä¸­é€šè¿‡ props æŠŠä¿¡æ¯ä¼ é€’ä¸‹å»
- æœ€åï¼Œå‘ä¸‹ä¼ é€’äº‹ä»¶å¤„ç†ç¨‹åºï¼Œä»¥ä¾¿å­ç»„ä»¶å¯ä»¥æ”¹å˜çˆ¶ç»„ä»¶çš„ state ã€‚
- è€ƒè™‘è¯¥å°†ç»„ä»¶è§†ä¸ºâ€œå—æ§â€ï¼ˆç”± prop é©±åŠ¨ï¼‰æˆ–æ˜¯â€œä¸å—æ§â€ï¼ˆç”± state é©±åŠ¨ï¼‰æ˜¯ååˆ†æœ‰ç›Šçš„ã€‚

### å¯¹ state è¿›è¡Œä¿ç•™å’Œé‡ç½® [ğŸ”—](https://react.docschina.org/learn/preserving-and-resetting-state)

- å„ä¸ªç»„ä»¶çš„ state æ˜¯å„è‡ªç‹¬ç«‹çš„ã€‚æ ¹æ®ç»„ä»¶åœ¨ UI æ ‘ä¸­çš„ä½ç½®ï¼ŒReact å¯ä»¥è·Ÿè¸ªå“ªäº› state å±äºå“ªä¸ªç»„ä»¶ã€‚ä½ å¯ä»¥æ§åˆ¶åœ¨é‡æ–°æ¸²æŸ“è¿‡ç¨‹ä¸­ä½•æ—¶å¯¹ state è¿›è¡Œä¿ç•™å’Œé‡ç½®ã€‚
- React ä¼šä¸º UI ä¸­çš„ç»„ä»¶ç»“æ„æ„å»ºæ¸²æŸ“æ ‘(UI æ ‘),çŠ¶æ€ä¸æ¸²æŸ“æ ‘ä¸­çš„ä½ç½®ç›¸å…³
- å¯¹ React æ¥è¯´é‡è¦çš„æ˜¯ç»„ä»¶åœ¨ UI æ ‘ä¸­çš„ä½ç½®,è€Œä¸æ˜¯åœ¨ JSX ä¸­çš„ä½ç½®
- æ°¸è¿œè¦å°†ç»„ä»¶å®šä¹‰åœ¨æœ€ä¸Šå±‚ï¼Œä¸è¦åµŒå¥—ç»„ä»¶çš„å®šä¹‰ï¼Œå¦åˆ™ä½ ä¼šæ„å¤–åœ°å¯¼è‡´ state è¢«é‡ç½®ã€‚
- å½“ä½ åœ¨ç›¸åŒä½ç½®æ¸²æŸ“ä¸åŒçš„ç»„ä»¶æ—¶ï¼Œè¿™ä¸ªç»„ä»¶çš„æ•´ä¸ªå­æ ‘éƒ½ä¼šè¢«é‡ç½®
- å¦‚æœä½ æƒ³åœ¨é‡æ–°æ¸²æŸ“æ—¶ä¿ç•™ stateï¼Œå‡ æ¬¡æ¸²æŸ“ä¸­çš„æ ‘å½¢ç»“æ„å°±åº”è¯¥ç›¸äº’â€œåŒ¹é…â€ã€‚ç»“æ„ä¸åŒå°±ä¼šå¯¼è‡´ state çš„é”€æ¯ï¼Œå› ä¸º React ä¼šåœ¨å°†ä¸€ä¸ªç»„ä»¶ä»æ ‘ä¸­ç§»é™¤æ—¶é”€æ¯å®ƒçš„ stateã€‚
- ç›¸åŒä½ç½®çš„ç›¸åŒç»„ä»¶ä¼šä½¿å¾— state è¢«ä¿ç•™ä¸‹æ¥
- ç›¸åŒä½ç½®çš„ä¸åŒç»„ä»¶ä¼šä½¿ state é‡ç½®
- åœ¨ç›¸åŒä½ç½®é‡ç½® state
  - å°†ç»„ä»¶æ¸²æŸ“åœ¨ä¸åŒçš„ä½ç½®
  - ä½¿ç”¨ `key` æ¥é‡ç½® state (è¯·è®°ä½ key ä¸æ˜¯å…¨å±€å”¯ä¸€çš„ã€‚å®ƒä»¬åªèƒ½æŒ‡å®š**çˆ¶ç»„ä»¶å†…éƒ¨**çš„é¡ºåºã€‚)

### è¿ç§»çŠ¶æ€é€»è¾‘è‡³ Reducer

å¯¹äºæ‹¥æœ‰è®¸å¤šçŠ¶æ€æ›´æ–°é€»è¾‘çš„ç»„ä»¶æ¥è¯´ï¼Œè¿‡äºåˆ†æ•£çš„äº‹ä»¶å¤„ç†ç¨‹åºå¯èƒ½ä¼šä»¤äººä¸çŸ¥æ‰€æªã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œä½ å¯ä»¥å°†ç»„ä»¶çš„æ‰€æœ‰çŠ¶æ€æ›´æ–°é€»è¾‘æ•´åˆåˆ°ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ä¸­ï¼Œè¿™ä¸ªå‡½æ•°å«ä½œ reducerã€‚

- ä¸ºä»€ä¹ˆç§°ä¹‹ä¸º reducer? (ğŸ”—)[https://react.docschina.org/learn/extracting-state-logic-into-a-reducer#why-are-reducers-called-this-way]
- useReducer é’©å­æ¥å— 2 ä¸ªå‚æ•°ï¼š
  - ä¸€ä¸ª reducer å‡½æ•°
  - ä¸€ä¸ªåˆå§‹çš„ state
- è¿”å›å¦‚ä¸‹
  - ä¸€ä¸ªæœ‰çŠ¶æ€çš„å€¼
  - ä¸€ä¸ª dispatch å‡½æ•°ï¼ˆç”¨æ¥â€œæ´¾å‘â€ç”¨æˆ·æ“ä½œç»™ reducerï¼‰
- ç¼–å†™ä¸€ä¸ªå¥½çš„ reducers
  - reducers å¿…é¡»æ˜¯çº¯ç²¹çš„
  - æ¯ä¸ª action éƒ½æè¿°äº†ä¸€ä¸ªå•ä¸€çš„ç”¨æˆ·äº¤äº’ï¼Œå³ä½¿å®ƒä¼šå¼•å‘æ•°æ®çš„å¤šä¸ªå˜åŒ–ã€‚
- ä½¿ç”¨ç¤ºä¾‹

```jsx
import { useReducer } from 'react'

function tasksReducer(tasks, action) {
  switch (action.type) {
    case 'create':
      return [
        ...tasks,
        {
          id: tasks.length + 1,
          text: action.text,
        },
      ]
    case 'delete':
      return tasks.filter(t => t.id !== action.id)
    default:
      throw Error('æœªçŸ¥ action:' + action.type)
  }
}

function App() {
  const [tasks, dispatch] = useReducer(tasksReducer, [
    {
      id: 1,
      text: 'ç¬¬ä¸€ä¸ªä»»åŠ¡',
    },
  ])

  return (
    <>
      <ul>
        {tasks.map(task => (
          <li key={task.id}>{task.text}</li>
        ))}
      </ul>
      <button onClick={() => dispatch({ type: 'create', text: 'æµ‹è¯•' })}>
        æ·»åŠ 
      </button>
      <button onClick={() => dispatch({ type: 'delete', id: 1 })}>åˆ é™¤</button>
    </>
  )
}
```

- å®ç°ä¸€ä¸ª useReducer

```jsx
import { useState } from 'react'
function useReducer(reducer, initialState) {
  const [state, setState] = useState(initialState)

  function dispatch(action) {
    setState(s => reducer(s, action))
  }
  return [state, dispatch]
}
```

### ä½¿ç”¨ Context ç”Ÿæˆä¼ é€’å‚æ•°

é€šå¸¸æ¥è¯´ï¼Œä½ ä¼šé€šè¿‡ props å°†ä¿¡æ¯ä»çˆ¶ç»„ä»¶ä¼ é€’åˆ°å­ç»„ä»¶ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å¿…é¡»é€šè¿‡è®¸å¤šä¸­é—´ç»„ä»¶å‘ä¸‹ä¼ é€’ propsï¼Œæˆ–æ˜¯åœ¨ä½ åº”ç”¨ä¸­çš„è®¸å¤šç»„ä»¶éœ€è¦ç›¸åŒçš„ä¿¡æ¯ï¼Œä¼ é€’ props ä¼šå˜çš„ååˆ†å†—é•¿å’Œä¸ä¾¿ã€‚Context å…è®¸çˆ¶ç»„ä»¶å‘å…¶ä¸‹å±‚æ— è®ºå¤šæ·±çš„ä»»ä½•ç»„ä»¶æä¾›ä¿¡æ¯ï¼Œè€Œæ— éœ€é€šè¿‡ props æ˜¾å¼ä¼ é€’ã€‚

- ä½¿ç”¨å‰è€ƒè™‘
  - ä¼ é€’ props æ˜¯å¦å¯è¡Œ
  - æŠ½è±¡ç»„ä»¶å¹¶å°† JSX ä½œä¸º children ä¼ é€’ç»™ä»–ä»¬
- ä½¿ç”¨æ–¹æ³•
  - é€šè¿‡ `export const MyContext = createContext(defaultValue)`åˆ›å»ºå¹¶å¯¼å‡º contextã€‚
  - åœ¨æ— è®ºå±‚çº§å¤šæ·±çš„ä»»ä½•å­ç»„ä»¶ä¸­ï¼ŒæŠŠ context ä¼ é€’ç»™ `useContext(MyContext)` Hook æ¥è¯»å–å®ƒã€‚
  - åœ¨çˆ¶ç»„ä»¶ä¸­æŠŠ children åŒ…åœ¨ `<MyContext.Provider value={...}>` ä¸­æ¥æä¾› contextã€‚

## è„±å›´æœºåˆ¶

### ä½¿ç”¨ ref å¼•ç”¨å€¼

å½“ä½ å¸Œæœ›ç»„ä»¶â€œè®°ä½â€æŸäº›ä¿¡æ¯ï¼Œä½†åˆä¸æƒ³è®©è¿™äº›ä¿¡æ¯ è§¦å‘æ–°çš„æ¸²æŸ“ æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ ref ã€‚

- ref æ˜¯ä¸€ç§è„±å›´æœºåˆ¶ï¼Œç”¨äºä¿ç•™ä¸ç”¨äºæ¸²æŸ“çš„å€¼ã€‚ä½ ä¸ä¼šç»å¸¸éœ€è¦å®ƒä»¬ã€‚
- ref æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œå…·æœ‰ä¸€ä¸ªåä¸º current çš„å±æ€§ï¼Œä½ å¯ä»¥å¯¹å…¶è¿›è¡Œè¯»å–æˆ–è®¾ç½®ã€‚
- ä¸ state ä¸€æ ·ï¼Œref å…è®¸ä½ åœ¨ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ä¹‹é—´ä¿ç•™ä¿¡æ¯ã€‚
- ä¸ state ä¸åŒï¼Œè®¾ç½® ref çš„ current å€¼ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ã€‚
- ä¸è¦åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­è¯»å–æˆ–å†™å…¥ ref.currentã€‚è¿™ä½¿ä½ çš„ç»„ä»¶éš¾ä»¥é¢„æµ‹ã€‚
- å½“ä½ å¸Œæœ›ç»„ä»¶â€œè®°ä½â€æŸäº›ä¿¡æ¯ï¼Œä½†åˆä¸æƒ³è®©è¿™äº›ä¿¡æ¯ è§¦å‘æ–°çš„æ¸²æŸ“ æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ ref ã€‚
- åƒ state ä¸€æ ·ï¼Œä½ å¯ä»¥è®©å®ƒæŒ‡å‘ä»»ä½•ä¸œè¥¿ï¼šå­—ç¬¦ä¸²ã€å¯¹è±¡ï¼Œç”šè‡³æ˜¯å‡½æ•°ã€‚
- ä½•æ—¶ä½¿ç”¨ ref
  - å­˜å‚¨ timeout ID
  - å­˜å‚¨å’Œæ“ä½œ DOM å…ƒç´ 
  - å­˜å‚¨ä¸éœ€è¦è¢«ç”¨æ¥è®¡ç®— JSX çš„å…¶ä»–å¯¹è±¡ã€‚
- `useRef` å†…éƒ¨å¦‚ä½•è¿è¡Œçš„

```js
import { useState } from 'react'

export function useRef(initialValue) {
  const [state, _] = useState({ current: initialValue })
  return state
}
```

- ref å’Œ state çš„ä¸åŒä¹‹å¤„

  | ref                                                     | state                                                                                                                    |
  | ------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------ |
  | `useRef(initialValue)`è¿”å› `{ current: initialValue }`  | `useState(initialValue)` è¿”å› state å˜é‡çš„å½“å‰å€¼å’Œä¸€ä¸ª state è®¾ç½®å‡½æ•° ( `[value, setValue]`)                             |
  | æ›´æ”¹æ—¶ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“                                  | æ›´æ”¹æ—¶è§¦å‘é‡æ–°æ¸²æŸ“ã€‚                                                                                                     |
  | å¯å˜ â€”â€” ä½ å¯ä»¥åœ¨æ¸²æŸ“è¿‡ç¨‹ä¹‹å¤–ä¿®æ”¹å’Œæ›´æ–° `current` çš„å€¼ã€‚ | â€œä¸å¯å˜â€ â€”â€” ä½ å¿…é¡»ä½¿ç”¨ state è®¾ç½®å‡½æ•°æ¥ä¿®æ”¹ state å˜é‡ï¼Œä»è€Œæ’é˜Ÿé‡æ–°æ¸²æŸ“ã€‚                                               |
  | ä½ ä¸åº”åœ¨æ¸²æŸ“æœŸé—´è¯»å–ï¼ˆæˆ–å†™å…¥ï¼‰ `current` å€¼ã€‚           | ä½ å¯ä»¥éšæ—¶è¯»å– stateã€‚ä½†æ˜¯ï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½æœ‰è‡ªå·±ä¸å˜çš„ state [å¿«ç…§](https://react.docschina.org/learn/state-as-a-snapshot)ã€‚ |

### ä½¿ç”¨ ref æ“ä½œ DOM

ç”±äº React ä¼šè‡ªåŠ¨å¤„ç†æ›´æ–° DOM ä»¥åŒ¹é…ä½ çš„æ¸²æŸ“è¾“å‡ºï¼Œå› æ­¤ä½ åœ¨ç»„ä»¶ä¸­é€šå¸¸ä¸éœ€è¦æ“ä½œ DOMã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶ä½ å¯èƒ½éœ€è¦è®¿é—®ç”± React ç®¡ç†çš„ DOM å…ƒç´  â€”â€” ä¾‹å¦‚ï¼Œè®©ä¸€ä¸ªèŠ‚ç‚¹è·å¾—ç„¦ç‚¹ã€æ»šåŠ¨åˆ°å®ƒæˆ–æµ‹é‡å®ƒçš„å°ºå¯¸å’Œä½ç½®ã€‚åœ¨ React ä¸­æ²¡æœ‰å†…ç½®çš„æ–¹æ³•æ¥åšè¿™äº›äº‹æƒ…ï¼Œæ‰€ä»¥ä½ éœ€è¦ä¸€ä¸ªæŒ‡å‘ DOM èŠ‚ç‚¹çš„ ref æ¥å®ç°ã€‚

- å¦‚ä½•ä½¿ç”¨ ref å›è°ƒç®¡ç† ref åˆ—è¡¨ [ğŸ”—](https://react.docschina.org/learn/manipulating-the-dom-with-refs#how-to-manage-a-list-of-refs-using-a-ref-callback)
- ä½¿ç”¨å‘½ä»¤å¥æŸ„æš´éœ²ä¸€éƒ¨åˆ† API [ğŸ”—](https://react.docschina.org/learn/manipulating-the-dom-with-refs#exposing-a-subset-of-the-api-with-an-imperative-handle)

```jsx
import { useRef, forwardRef, useImperativeHandel } from 'react'

export const MyInput = forwardRef((props, ref) => {
  const inputRef = useRef(null)
  useImperativeHandle(ref, () => ({
    focus() {
      inputRef.current.focus()
    },
  }))

  return <input {...props} ref={inputRef} />
})
```

> é€šå¸¸ï¼Œä½  ä¸å¸Œæœ› åœ¨æ¸²æŸ“æœŸé—´è®¿é—® refsã€‚è¿™ä¹Ÿé€‚ç”¨äºä¿å­˜ DOM èŠ‚ç‚¹çš„ refsã€‚åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æœŸé—´ï¼ŒDOM èŠ‚ç‚¹å°šæœªåˆ›å»ºï¼Œå› æ­¤ ref.current å°†ä¸º nullã€‚åœ¨æ¸²æŸ“æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼ŒDOM èŠ‚ç‚¹è¿˜æ²¡æœ‰æ›´æ–°ã€‚æ‰€ä»¥è¯»å–å®ƒä»¬è¿˜ä¸ºæ—¶è¿‡æ—©ã€‚
> React åœ¨æäº¤é˜¶æ®µè®¾ç½® ref.currentã€‚åœ¨æ›´æ–° DOM ä¹‹å‰ï¼ŒReact å°†å—å½±å“çš„ ref.current å€¼è®¾ç½®ä¸º nullã€‚æ›´æ–° DOM åï¼ŒReact ç«‹å³å°†å®ƒä»¬è®¾ç½®åˆ°ç›¸åº”çš„ DOM èŠ‚ç‚¹ã€‚

- React ä½•æ—¶æ·»åŠ  refs [ğŸ”—](https://react.docschina.org/learn/manipulating-the-dom-with-refs#when-react-attaches-the-refs)
  - åœ¨ æ¸²æŸ“ é˜¶æ®µï¼Œ React è°ƒç”¨ä½ çš„ç»„ä»¶æ¥ç¡®å®šå±å¹•ä¸Šåº”è¯¥æ˜¾ç¤ºä»€ä¹ˆã€‚
  - åœ¨ æäº¤ é˜¶æ®µï¼Œ React æŠŠå˜æ›´åº”ç”¨äº DOMã€‚
- ä½¿ç”¨ flushSync åŒæ­¥æ›´æ–° state [ğŸ”—](https://react.docschina.org/learn/manipulating-the-dom-with-refs#flushing-state-updates-synchronously-with-flush-sync)
- é¿å…æ›´æ”¹ç”± React ç®¡ç†çš„ DOM èŠ‚ç‚¹

### ä½¿ç”¨ `Effect` åŒæ­¥

æœ‰äº›ç»„ä»¶éœ€è¦ä¸å¤–éƒ¨ç³»ç»ŸåŒæ­¥ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›æ ¹æ® React state æ§åˆ¶é React ç»„ä»¶ã€è®¾ç½®æœåŠ¡å™¨è¿æ¥æˆ–åœ¨ç»„ä»¶å‡ºç°åœ¨å±å¹•ä¸Šæ—¶å‘é€åˆ†ææ—¥å¿—ã€‚Effects ä¼šåœ¨æ¸²æŸ“åè¿è¡Œä¸€äº›ä»£ç ï¼Œä»¥ä¾¿å¯ä»¥å°†ç»„ä»¶ä¸ React ä¹‹å¤–çš„æŸäº›ç³»ç»ŸåŒæ­¥ã€‚

ä¸ªäººç†è§£ï¼šstate å˜åŒ–è§¦å‘æ¸²æŸ“ï¼ˆæ¸²æŸ“é€»è¾‘ä»£ç ç»„ä»¶å‡½æ•°ï¼‰ï¼Œå‘Šè¯‰ React ä¸‹ä¸€æ¬¡æ¸²æŸ“åæ‰§è¡Œè¿™äº›å‰¯ä½œç”¨ï¼ˆeffectï¼‰

- React ç»„ä»¶ä¸¤ç§é€»è¾‘ç±»å‹
  - **æ¸²æŸ“é€»è¾‘ä»£ç **ï¼ˆåœ¨ æè¿° UI ä¸­æœ‰ä»‹ç»ï¼‰ä½äºç»„ä»¶çš„é¡¶å±‚ã€‚ä½ å°†åœ¨è¿™é‡Œæ¥æ”¶ props å’Œ stateï¼Œå¹¶å¯¹å®ƒä»¬è¿›è¡Œè½¬æ¢ï¼Œæœ€ç»ˆè¿”å›ä½ æƒ³åœ¨å±å¹•ä¸Šçœ‹åˆ°çš„ JSXã€‚æ¸²æŸ“çš„ä»£ç å¿…é¡»æ˜¯çº¯ç²¹çš„â€”â€”å°±åƒæ•°å­¦å…¬å¼ä¸€æ ·ï¼Œå®ƒåªåº”è¯¥â€œè®¡ç®—â€ç»“æœï¼Œè€Œä¸åšå…¶ä»–ä»»ä½•äº‹æƒ…ã€‚
  - **äº‹ä»¶å¤„ç†ç¨‹åº**ï¼ˆåœ¨ æ·»åŠ äº¤äº’æ€§ ä¸­ä»‹ç»ï¼‰æ˜¯åµŒå¥—åœ¨ç»„ä»¶å†…éƒ¨çš„å‡½æ•°ï¼Œè€Œä¸ä»…ä»…æ˜¯è®¡ç®—å‡½æ•°ã€‚äº‹ä»¶å¤„ç†ç¨‹åºå¯èƒ½ä¼šæ›´æ–°è¾“å…¥å­—æ®µã€æäº¤ HTTP POST è¯·æ±‚ä»¥è´­ä¹°äº§å“ï¼Œæˆ–è€…å°†ç”¨æˆ·å¯¼èˆªåˆ°å¦ä¸€ä¸ªå±å¹•ã€‚äº‹ä»¶å¤„ç†ç¨‹åºåŒ…å«ç”±ç‰¹å®šç”¨æˆ·æ“ä½œï¼ˆä¾‹å¦‚æŒ‰é’®ç‚¹å‡»æˆ–é”®å…¥ï¼‰å¼•èµ·çš„â€œå‰¯ä½œç”¨â€ï¼ˆå®ƒä»¬æ”¹å˜äº†ç¨‹åºçš„çŠ¶æ€ï¼‰ã€‚
- Effect å…è®¸ä½ æŒ‡å®šç”±æ¸²æŸ“æœ¬èº«ï¼Œè€Œä¸æ˜¯ç‰¹å®šäº‹ä»¶å¼•èµ·çš„å‰¯ä½œç”¨ã€‚
- ä½¿ç”¨ useEffect åŒ…è£¹å‰¯ä½œç”¨ï¼ŒæŠŠå®ƒåˆ†ç¦»åˆ°æ¸²æŸ“é€»è¾‘çš„è®¡ç®—è¿‡ç¨‹ä¹‹å¤–
- React ä½¿ç”¨ `Object.is` æ¯”è¾ƒä¾èµ–é¡¹çš„å€¼
- é»˜è®¤æƒ…å†µä¸‹ï¼ŒEffect åœ¨æ¯æ¬¡æ¸²æŸ“ï¼ˆåŒ…æ‹¬åˆå§‹æ¸²æŸ“ï¼‰åè¿è¡Œï¼Œåˆæ¬¡æ¸²æŸ“éƒ½ä¼šæ‰§è¡Œï¼Œå†æ¬¡æ¸²æŸ“ä¼šå¯¹æ¯”ä¾èµ–é¡¹çš„å€¼
- å¦‚æœ React çš„æ‰€æœ‰ä¾èµ–é¡¹éƒ½ä¸ä¸Šæ¬¡æ¸²æŸ“æ—¶çš„å€¼ç›¸åŒï¼Œåˆ™å°†è·³è¿‡æœ¬æ¬¡ Effectã€‚
- ä¸èƒ½éšæ„é€‰æ‹©ä¾èµ–é¡¹ï¼Œå®ƒä»¬æ˜¯ç”± Effect å†…éƒ¨çš„ä»£ç å†³å®šçš„ã€‚
- ç©ºçš„ä¾èµ–æ•°ç»„ï¼ˆ[]ï¼‰å¯¹åº”äºç»„ä»¶â€œæŒ‚è½½â€ï¼Œå³æ·»åŠ åˆ°å±å¹•ä¸Šã€‚
- ä»…åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹çš„å¼€å‘ç¯å¢ƒä¸­ï¼ŒReact ä¼šæŒ‚è½½ä¸¤æ¬¡ç»„ä»¶ï¼Œä»¥å¯¹ Effect è¿›è¡Œå‹åŠ›æµ‹è¯•ã€‚
- å¦‚æœ Effect å› ä¸ºé‡æ–°æŒ‚è½½è€Œä¸­æ–­ï¼Œé‚£ä¹ˆéœ€è¦å®ç°ä¸€ä¸ªæ¸…ç†å‡½æ•°ã€‚
- React å°†åœ¨ä¸‹æ¬¡ Effect è¿è¡Œä¹‹å‰ä»¥åŠå¸è½½æœŸé—´è¿™ä¸¤ä¸ªæ—¶å€™è°ƒç”¨æ¸…ç†å‡½æ•°ã€‚ æ€»æ˜¯åœ¨æ‰§è¡Œä¸‹ä¸€è½®æ¸²æŸ“çš„ Effect ä¹‹å‰æ¸…ç†ä¸Šä¸€è½®æ¸²æŸ“çš„ Effectï¼›
- æ¯ä¸€è½®æ¸²æŸ“éƒ½æœ‰è‡ªå·±çš„ Effectï¼Œåªä¸è¿‡ä¼šå¯¹æ¯”ä¾èµ–çš„å·®å¼‚ç¡®å®šæ‰§ä¸æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°ç”Ÿæˆ effect [ğŸ”—](https://react.docschina.org/learn/synchronizing-with-effects#each-render-has-its-own-effects)

### ä½ å¯èƒ½ä¸éœ€è¦ Effect

Effect æ˜¯ React èŒƒå¼ä¸­çš„ä¸€ç§è„±å›´æœºåˆ¶ã€‚å®ƒä»¬è®©ä½ å¯ä»¥ â€œé€ƒå‡ºâ€ React å¹¶ä½¿ç»„ä»¶å’Œä¸€äº›å¤–éƒ¨ç³»ç»ŸåŒæ­¥ï¼Œæ¯”å¦‚é React ç»„ä»¶ã€ç½‘ç»œå’Œæµè§ˆå™¨ DOMã€‚å¦‚æœæ²¡æœ‰æ¶‰åŠåˆ°å¤–éƒ¨ç³»ç»Ÿï¼ˆä¾‹å¦‚ï¼Œä½ æƒ³æ ¹æ® props æˆ– state çš„å˜åŒ–æ¥æ›´æ–°ä¸€ä¸ªç»„ä»¶çš„ stateï¼‰ï¼Œä½ å°±ä¸åº”è¯¥ä½¿ç”¨ Effectã€‚ç§»é™¤ä¸å¿…è¦çš„ Effect å¯ä»¥è®©ä½ çš„ä»£ç æ›´å®¹æ˜“ç†è§£ï¼Œè¿è¡Œå¾—æ›´å¿«ï¼Œå¹¶ä¸”æ›´å°‘å‡ºé”™ã€‚

- å¦‚æœä¸€ä¸ªå€¼å¯ä»¥åŸºäºç°æœ‰çš„ props æˆ– state è®¡ç®—å¾—å‡ºï¼Œä¸è¦æŠŠå®ƒä½œä¸ºä¸€ä¸ª stateï¼Œè€Œæ˜¯åœ¨æ¸²æŸ“æœŸé—´ç›´æ¥è®¡ç®—è¿™ä¸ªå€¼
- ä½ ä¸å¿…ä½¿ç”¨ Effect æ¥å¤„ç†ç”¨æˆ·äº‹ä»¶
- ä½¿ç”¨ `useMemo` ç¼“å­˜ä¸€ä¸ªæ˜‚è´µçš„è®¡ç®—ï¼Œä¼šåœ¨æ¸²æŸ“æœŸé—´æ‰§è¡Œ

```jsx
import { useMemo } from 'react'
function TodoLis({ todos, filter }) {
  const visibleTodos = useMemo(() => {
    // âœ… é™¤é todos æˆ– filter å‘ç”Ÿå˜åŒ–ï¼Œå¦åˆ™ä¸ä¼šé‡æ–°æ‰§è¡Œ
    return getFilteredTodos(todos, filter)
  }, [todos, filter])
}
```

- åœ¨æ¸²æŸ“æœŸé—´æ›´æ–°ç»„ä»¶æ—¶ï¼ŒReact ä¼šä¸¢å¼ƒå·²ç»è¿”å›çš„ JSX å¹¶ç«‹å³å°è¯•é‡æ–°æ¸²æŸ“ï¼Œä¸ºäº†é¿å…éå¸¸ç¼“æ…¢çš„çº§è”é‡è¯•ï¼ŒReact åªå…è®¸åœ¨æ¸²æŸ“æœŸé—´æ›´æ–° åŒä¸€ ç»„ä»¶çš„çŠ¶æ€ã€‚
- å½“ props å˜åŒ–æ—¶é‡ç½®æ‰€æœ‰ stateï¼Œä½¿ç”¨`key`,`key`ä¸åŒçš„ç»„ä»¶ä¼šè¢«è§†ä¸ºä¸¤ä¸ªä¸åº”å…±äº«ä»»ä½•çŠ¶æ€çš„ä¸åŒç»„ä»¶
- å½“ä½ ä¸ç¡®å®šæŸäº›ä»£ç åº”è¯¥æ”¾åœ¨ Effect ä¸­è¿˜æ˜¯äº‹ä»¶å¤„ç†å‡½æ•°ä¸­æ—¶ï¼Œå…ˆè‡ªé—® ä¸ºä»€ä¹ˆ è¦æ‰§è¡Œè¿™äº›ä»£ç ã€‚Effect åªç”¨æ¥æ‰§è¡Œé‚£äº›æ˜¾ç¤ºç»™ç”¨æˆ·æ—¶ç»„ä»¶ éœ€è¦æ‰§è¡Œ çš„ä»£ç 
- è®¢é˜…å¤–éƒ¨ store ï¼Œä½¿ç”¨ `useSyncExternalStore`

```js
function subscribe(cb) {
  window.addEventListener('online', cb)
  window.addEventListener('offline', cb)
  return () => {
    window.removeEventListener('online', cb)
    window.removeEventListener('offline', cb)
  }
}

function useOnlineStatus() {
  return useSyncExternalStore(
    subscribe,
    () => navigator.onLine,
    () => true,
  )
}

function App() {
  const isOnline = useOnlineStatus()
}
```

- å®ç°ä¸€ä¸ª`useSyncExternalStore`

```js
import { useState, useEffect } from 'react'
function useSyncExternalStore(subscribe, defaultValue) {
  const [state, setState] = useState(defaultValue())

  useEffect(() => {
    const clearEffectFn = subscribe(() => {
      setState(defaultValue())
    })
    return clearEffectFn
  }, [])
}
```

- å¦‚æœä½ å¯ä»¥åœ¨æ¸²æŸ“æœŸé—´è®¡ç®—æŸäº›å†…å®¹ï¼Œåˆ™ä¸éœ€è¦ä½¿ç”¨ Effectã€‚
- æƒ³è¦ç¼“å­˜æ˜‚è´µçš„è®¡ç®—ï¼Œè¯·ä½¿ç”¨ useMemo è€Œä¸æ˜¯ useEffectã€‚
- æƒ³è¦é‡ç½®æ•´ä¸ªç»„ä»¶æ ‘çš„ stateï¼Œè¯·ä¼ å…¥ä¸åŒçš„ keyã€‚
- æƒ³è¦åœ¨ prop å˜åŒ–æ—¶é‡ç½®æŸäº›ç‰¹å®šçš„ stateï¼Œè¯·åœ¨æ¸²æŸ“æœŸé—´å¤„ç†ã€‚
- ç»„ä»¶ æ˜¾ç¤º æ—¶å°±éœ€è¦æ‰§è¡Œçš„ä»£ç åº”è¯¥æ”¾åœ¨ Effect ä¸­ï¼Œå¦åˆ™åº”è¯¥æ”¾åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ã€‚
- å¦‚æœä½ éœ€è¦æ›´æ–°å¤šä¸ªç»„ä»¶çš„ stateï¼Œæœ€å¥½åœ¨å•ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ä¸­å¤„ç†ã€‚
- å½“ä½ å°è¯•åœ¨ä¸åŒç»„ä»¶ä¸­åŒæ­¥ state å˜é‡æ—¶ï¼Œè¯·è€ƒè™‘çŠ¶æ€æå‡ã€‚
- ä½ å¯ä»¥ä½¿ç”¨ Effect è·å–æ•°æ®ï¼Œä½†ä½ éœ€è¦å®ç°æ¸…é™¤é€»è¾‘ä»¥é¿å…[ç«æ€æ¡ä»¶](https://en.wikipedia.org/wiki/Race_condition)ã€‚

### å“åº”å¼ Effect çš„ç”Ÿå‘½å‘¨æœŸ

Effect ä¸ç»„ä»¶æœ‰ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸã€‚ç»„ä»¶å¯ä»¥æŒ‚è½½ã€æ›´æ–°æˆ–å¸è½½ã€‚Effect åªèƒ½åšä¸¤ä»¶äº‹ï¼šå¼€å§‹åŒæ­¥æŸäº›ä¸œè¥¿ï¼Œç„¶ååœæ­¢åŒæ­¥å®ƒã€‚å¦‚æœ Effect ä¾èµ–äºéšæ—¶é—´å˜åŒ–çš„ props å’Œ stateï¼Œè¿™ä¸ªå¾ªç¯å¯èƒ½ä¼šå‘ç”Ÿå¤šæ¬¡ã€‚React æä¾›äº†ä»£ç æ£€æŸ¥è§„åˆ™æ¥æ£€æŸ¥æ˜¯å¦æ­£ç¡®åœ°æŒ‡å®šäº† Effect çš„ä¾èµ–é¡¹ï¼Œè¿™èƒ½å¤Ÿä½¿ Effect ä¸æœ€æ–°çš„ props å’Œ state ä¿æŒåŒæ­¥ã€‚

- React ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ
  - å½“ç»„ä»¶è¢«æ·»åŠ åˆ°å±å¹•ä¸Šæ—¶ï¼Œå®ƒä¼šè¿›è¡Œç»„ä»¶çš„ æŒ‚è½½ã€‚
  - å½“ç»„ä»¶æ¥æ”¶åˆ°æ–°çš„ props æˆ– state æ—¶ï¼Œé€šå¸¸æ˜¯ä½œä¸ºå¯¹äº¤äº’çš„å“åº”ï¼Œå®ƒä¼šè¿›è¡Œç»„ä»¶çš„ æ›´æ–°ã€‚
  - å½“ç»„ä»¶ä»å±å¹•ä¸Šç§»é™¤æ—¶ï¼Œå®ƒä¼šè¿›è¡Œç»„ä»¶çš„ å¸è½½ã€‚
- æ¯ä¸ª Effect è¡¨ç¤ºä¸€ä¸ªç‹¬ç«‹çš„åŒæ­¥è¿‡ç¨‹
- ä»ç»„ä»¶çš„è§’åº¦æ¥çœ‹ï¼Œç©ºçš„ [] ä¾èµ–æ•°ç»„æ„å‘³ç€è¿™ä¸ª Effect ä»…åœ¨ç»„ä»¶æŒ‚è½½æ—¶è¿æ¥åˆ°èŠå¤©å®¤ï¼Œå¹¶åœ¨ç»„ä»¶å¸è½½æ—¶æ–­å¼€è¿æ¥ã€‚
- åœ¨ç»„ä»¶ä¸»ä½“ä¸­å£°æ˜çš„æ‰€æœ‰å˜é‡éƒ½æ˜¯å“åº”å¼çš„,ä»»ä½•å“åº”å¼å€¼éƒ½å¯ä»¥åœ¨é‡æ–°æ¸²æŸ“æ—¶å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦å°†å“åº”å¼å€¼åŒ…æ‹¬åœ¨ Effect çš„ä¾èµ–é¡¹ä¸­ã€‚
- æ¯ä¸ª Effect æè¿°äº†ä¸€ä¸ªç‹¬ç«‹çš„åŒæ­¥è¿‡ç¨‹ï¼Œå¯ä»¥ å¼€å§‹ å’Œ åœæ­¢ã€‚
- åœ¨ç¼–å†™å’Œè¯»å– Effect æ—¶ï¼Œè¦ç‹¬ç«‹åœ°è€ƒè™‘æ¯ä¸ª Effectï¼ˆå¦‚ä½•å¼€å§‹å’Œåœæ­¢åŒæ­¥ï¼‰ï¼Œè€Œä¸æ˜¯ä»ç»„ä»¶çš„è§’åº¦æ€è€ƒï¼ˆå¦‚ä½•æŒ‚è½½ã€æ›´æ–°æˆ–å¸è½½ï¼‰ã€‚
- ä¾èµ–é¡¹å¿…é¡»åŒ…æ‹¬ Effect ä¸­è¯»å–çš„æ¯ä¸ª å“åº”å¼å€¼
  - æ£€æŸ¥ Effect æ˜¯å¦è¡¨ç¤ºäº†ç‹¬ç«‹çš„åŒæ­¥è¿‡ç¨‹ã€‚å¦‚æœ Effect æ²¡æœ‰è¿›è¡Œä»»ä½•åŒæ­¥æ“ä½œï¼Œå¯èƒ½æ˜¯ä¸å¿…è¦çš„ã€‚å¦‚æœå®ƒåŒæ—¶è¿›è¡Œäº†å‡ ä¸ªç‹¬ç«‹çš„åŒæ­¥æ“ä½œï¼Œå°†å…¶æ‹†åˆ†ä¸ºå¤šä¸ª Effectã€‚
  - å¦‚æœæƒ³è¯»å– props æˆ– state çš„æœ€æ–°å€¼ï¼Œä½†åˆä¸æƒ³å¯¹å…¶åšå‡ºååº”å¹¶é‡æ–°åŒæ­¥ Effectï¼Œå¯ä»¥å°† Effect æ‹†åˆ†ä¸ºå…·æœ‰ååº”æ€§çš„éƒ¨åˆ†ï¼ˆä¿ç•™åœ¨ Effect ä¸­ï¼‰å’Œéååº”æ€§çš„éƒ¨åˆ†ï¼ˆæå–ä¸ºåä¸º â€œEffect Eventâ€ çš„å†…å®¹ï¼‰ã€‚é˜…è¯»å…³äº[å°†äº‹ä»¶ä¸ Effect åˆ†ç¦»çš„å†…å®¹](#å°†äº‹ä»¶ä»-effect-ä¸­åˆ†å¼€)ã€‚
  - é¿å…å°†å¯¹è±¡å’Œå‡½æ•°ä½œä¸ºä¾èµ–é¡¹,å¦‚æœåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­åˆ›å»ºå¯¹è±¡å’Œå‡½æ•°ï¼Œç„¶ååœ¨ Effect ä¸­è¯»å–å®ƒä»¬ï¼Œå®ƒä»¬å°†åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¸åŒã€‚è¿™å°†å¯¼è‡´ Effect æ¯æ¬¡éƒ½é‡æ–°åŒæ­¥ã€‚é˜…è¯»æœ‰å…³[ä» Effect ä¸­åˆ é™¤ä¸å¿…è¦ä¾èµ–é¡¹](#ç§»é™¤-effect-ä¾èµ–)

### å°†äº‹ä»¶ä» Effect ä¸­åˆ†å¼€

äº‹ä»¶å¤„ç†å‡½æ•°åªæœ‰åœ¨ä½ å†æ¬¡æ‰§è¡ŒåŒæ ·çš„äº¤äº’æ—¶æ‰ä¼šé‡æ–°è¿è¡Œã€‚Effect å’Œäº‹ä»¶å¤„ç†å‡½æ•°ä¸ä¸€æ ·ï¼Œå®ƒåªæœ‰åœ¨è¯»å–çš„ props æˆ– state å€¼å’Œä¸Šä¸€æ¬¡æ¸²æŸ“ä¸ä¸€æ ·æ—¶æ‰ä¼šé‡æ–°åŒæ­¥ã€‚æœ‰æ—¶ä½ éœ€è¦è¿™ä¸¤ç§è¡Œä¸ºçš„æ··åˆä½“ï¼šå³ä¸€ä¸ª Effect åªåœ¨å“åº”æŸäº›å€¼æ—¶é‡æ–°è¿è¡Œï¼Œä½†æ˜¯åœ¨å…¶ä»–å€¼å˜åŒ–æ—¶ä¸é‡æ–°è¿è¡Œã€‚

- äº‹ä»¶å¤„ç†å‡½æ•°åªåœ¨å“åº”ç‰¹å®šçš„äº¤äº’æ“ä½œæ—¶è¿è¡Œ
- Effect å’Œäº‹ä»¶å¤„ç†å‡½æ•°ä¸ä¸€æ ·ï¼Œå®ƒåªæœ‰åœ¨è¯»å–çš„ props æˆ– state å€¼å’Œä¸Šä¸€æ¬¡æ¸²æŸ“ä¸ä¸€æ ·æ—¶æ‰ä¼šé‡æ–°åŒæ­¥
- å“åº”å¼å€¼å’Œå“åº”å¼é€»è¾‘
  - äº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨çš„é€»è¾‘æ˜¯éå“åº”å¼çš„ã€‚
  - Effect å†…éƒ¨çš„é€»è¾‘æ˜¯å“åº”å¼çš„ï¼Œå¦‚æœ Effect è¦è¯»å–å“åº”å¼å€¼ï¼Œä½ å¿…é¡»å°†å®ƒæŒ‡å®šä¸ºä¾èµ–é¡¹ã€‚å¦‚æœæ¥ä¸‹æ¥çš„é‡æ–°æ¸²æŸ“å¼•èµ·é‚£ä¸ªå€¼å˜åŒ–ï¼ŒReact å°±ä¼šä½¿ç”¨æ–°å€¼é‡æ–°è¿è¡Œ Effect å†…çš„é€»è¾‘ã€‚
- Effect Event
  - éå“åº”å¼é€»è¾‘å’Œå‘¨å›´å“åº”å¼ Effect éš”ç¦»å¼€æ¥çš„æ–¹æ³•ã€‚
  - å®ƒæ˜¯ Effect é€»è¾‘çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯å…¶è¡Œä¸ºæ›´åƒäº‹ä»¶å¤„ç†å‡½æ•°ã€‚å®ƒå†…éƒ¨çš„é€»è¾‘ä¸æ˜¯å“åº”å¼çš„ï¼Œè€Œä¸”èƒ½ä¸€ç›´â€œçœ‹è§â€æœ€æ–°çš„ props å’Œ stateã€‚
- Effect Event çœ‹æˆå’Œäº‹ä»¶å¤„ç†å‡½æ•°ç›¸ä¼¼çš„ä¸œè¥¿ã€‚ä¸»è¦åŒºåˆ«æ˜¯äº‹ä»¶å¤„ç†å‡½æ•°åªåœ¨å“åº”ç”¨æˆ·äº¤äº’çš„æ—¶å€™è¿è¡Œï¼Œè€Œ Effect Event æ˜¯ä½ åœ¨ Effect ä¸­è§¦å‘çš„ã€‚Effect Event è®©ä½ åœ¨ Effect å“åº”æ€§å’Œä¸åº”æ˜¯å“åº”å¼çš„ä»£ç é—´â€œæ‰“ç ´é“¾æ¡â€
- ä¸ºä»€ä¹ˆéœ€è¦`useEffectEvent`ï¼Œçœ‹è¿™ä¸ª[ä¾‹å­](https://react.docschina.org/learn/separating-events-from-effects#is-it-okay-to-suppress-the-dependency-linter-instead)
- äº‹ä»¶å¤„ç†å‡½æ•°åœ¨å“åº”ç‰¹å®šäº¤äº’æ—¶è¿è¡Œ
- Effect åœ¨éœ€è¦åŒæ­¥çš„æ—¶å€™è¿è¡Œ
- äº‹ä»¶å¤„ç†å‡½æ•°å†…éƒ¨çš„é€»è¾‘æ˜¯éå“åº”å¼çš„,éå“åº”å¼é€»è¾‘ç§»è‡³ Effect Event ä¸­ï¼š
- Effect å†…éƒ¨çš„é€»è¾‘æ˜¯å“åº”å¼çš„ã€‚
- ä½ å¯ä»¥å°†éå“åº”å¼é€»è¾‘ä» Effect ç§»åˆ° Effect Event ä¸­ã€‚
- åªåœ¨ Effect å†…éƒ¨è°ƒç”¨ Effect Eventã€‚
- ä¸è¦å°† Effect Event ä¼ ç»™å…¶ä»–ç»„ä»¶æˆ–è€… Hookã€‚

### ç§»é™¤ Effect ä¾èµ–

å½“ç¼–å†™ Effect æ—¶ï¼Œlinter ä¼šéªŒè¯æ˜¯å¦å·²ç»å°† Effect è¯»å–çš„æ¯ä¸€ä¸ªå“åº”å¼å€¼ï¼ˆå¦‚ props å’Œ stateï¼‰åŒ…å«åœ¨ Effect çš„ä¾èµ–ä¸­ã€‚è¿™å¯ä»¥ç¡®ä¿ Effect ä¸ç»„ä»¶çš„ props å’Œ state ä¿æŒåŒæ­¥ã€‚ä¸å¿…è¦çš„ä¾èµ–å¯èƒ½ä¼šå¯¼è‡´ Effect è¿è¡Œè¿‡äºé¢‘ç¹ï¼Œç”šè‡³äº§ç”Ÿæ— é™å¾ªç¯ã€‚è¯·æŒ‰ç…§æœ¬æŒ‡å—å®¡æŸ¥å¹¶ç§»é™¤ Effect ä¸­ä¸å¿…è¦çš„ä¾èµ–ã€‚

æ¯å½“ä½ è°ƒæ•´ Effect çš„ä¾èµ–ä»¥é€‚é…ä»£ç æ—¶ï¼Œè¯·æ³¨æ„ä¸€ä¸‹å½“å‰çš„ä¾èµ–ã€‚å½“è¿™äº›ä¾èµ–å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè®© Effect é‡æ–°è¿è¡Œæ˜¯å¦æœ‰æ„ä¹‰ï¼Ÿæœ‰æ—¶ï¼Œç­”æ¡ˆæ˜¯â€œä¸â€ï¼š

1. ä½ å¯èƒ½æƒ³åœ¨ä¸åŒçš„æ¡ä»¶ä¸‹é‡æ–°æ‰§è¡Œ Effect çš„ ä¸åŒéƒ¨åˆ†ã€‚
2. ä½ å¯èƒ½æƒ³åªè¯»å–æŸä¸ªä¾èµ–çš„ æœ€æ–°å€¼ï¼Œè€Œä¸æ˜¯å¯¹å…¶å˜åŒ–åšå‡ºâ€œååº”â€ã€‚
3. ä¾èµ–å¯èƒ½ä¼šå› ä¸ºå®ƒçš„ç±»å‹æ˜¯å¯¹è±¡æˆ–å‡½æ•°è€Œ æ— æ„é—´ æ”¹å˜å¤ªé¢‘ç¹ã€‚

---

- å½“è¦ç§»é™¤ä¸€ä¸ªä¾èµ–æ—¶ï¼Œè¯·è¯æ˜å®ƒä¸æ˜¯ä¸€ä¸ªä¾èµ–,æ³¨æ„ï¼Œä½ ä¸èƒ½â€œé€‰æ‹©â€ Effect çš„ä¾èµ–ã€‚æ¯ä¸ªè¢« Effect æ‰€ä½¿ç”¨çš„å“åº”å¼å€¼ï¼Œå¿…é¡»åœ¨ä¾èµ–ä¸­å£°æ˜ã€‚ä¾èµ–æ˜¯ç”± Effect çš„ä»£ç å†³å®šçš„ï¼š
- å“åº”å¼å€¼ åŒ…æ‹¬ props ä»¥åŠæ‰€æœ‰ä½ ç›´æ¥åœ¨ç»„ä»¶ä¸­å£°æ˜çš„å˜é‡å’Œå‡½æ•°ã€‚
- ä¾èµ–åº”å§‹ç»ˆä¸ä»£ç åŒ¹é…ã€‚
- å½“ä½ å¯¹ä¾èµ–ä¸æ»¡æ„æ—¶ï¼Œä½ éœ€è¦ç¼–è¾‘çš„æ˜¯ä»£ç ã€‚
- æŠ‘åˆ¶ linter ä¼šå¯¼è‡´éå¸¸æ··ä¹±çš„é”™è¯¯ï¼Œä½ åº”è¯¥å§‹ç»ˆé¿å…å®ƒã€‚
- è¦ç§»é™¤ä¾èµ–ï¼Œä½ éœ€è¦å‘ linter â€œè¯æ˜â€å®ƒä¸æ˜¯å¿…éœ€çš„ã€‚
- å¦‚æœæŸäº›ä»£ç æ˜¯ä¸ºäº†å“åº”ç‰¹å®šäº¤äº’ï¼Œè¯·å°†è¯¥ä»£ç ç§»è‡³äº‹ä»¶å¤„ç†çš„åœ°æ–¹ã€‚
- å¦‚æœ Effect çš„ä¸åŒéƒ¨åˆ†å› ä¸åŒåŸå› éœ€è¦é‡æ–°è¿è¡Œï¼Œè¯·å°†å…¶æ‹†åˆ†ä¸ºå¤šä¸ª Effectã€‚
- å¦‚æœä½ æƒ³æ ¹æ®ä»¥å‰çš„çŠ¶æ€æ›´æ–°ä¸€äº›çŠ¶æ€ï¼Œä¼ é€’ä¸€ä¸ªæ›´æ–°å‡½æ•°ï¼ˆsetStateï¼‰ã€‚
- å¦‚æœä½ æƒ³è¯»å–æœ€æ–°å€¼è€Œä¸â€œååº”â€å®ƒï¼Œè¯·ä» Effect ä¸­æå–å‡ºä¸€ä¸ª Effect Eventã€‚
- åœ¨ JavaScript ä¸­ï¼Œå¦‚æœå¯¹è±¡å’Œå‡½æ•°æ˜¯åœ¨ä¸åŒæ—¶é—´åˆ›å»ºçš„ï¼Œåˆ™å®ƒä»¬è¢«è®¤ä¸ºæ˜¯ä¸åŒçš„ã€‚
- å°½é‡é¿å…å¯¹è±¡å’Œå‡½æ•°ä¾èµ–ã€‚å°†å®ƒä»¬ç§»åˆ°ç»„ä»¶å¤–æˆ– Effect å†…ã€‚
- é¿å…: Effect ä¸­æœ‰ç‰¹å®šäº‹ä»¶çš„é€»è¾‘ å¦‚`if(true) {// do something}`
- æ¯ä¸ª Effect åº”è¯¥ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„åŒæ­¥è¿‡ç¨‹,åˆ é™¤ä¸€ä¸ª Effect å¹¶ä¸ä¼šå½±å“åˆ°å¦ä¸€ä¸ª Effect çš„é€»è¾‘ã€‚è¿™æ„å‘³ç€ä»–ä»¬ åŒæ­¥ä¸åŒçš„äº‹æƒ…
- å¯¹è±¡å’Œå‡½æ•°ä½œä¸ºä¾èµ–ï¼Œä¼šä½¿ Effect æ¯”ä½ éœ€è¦çš„æ›´é¢‘ç¹åœ°é‡æ–°åŒæ­¥,åœ¨ JavaScript ä¸­ï¼Œæ¯ä¸ªæ–°åˆ›å»ºçš„å¯¹è±¡å’Œå‡½æ•°éƒ½è¢«è®¤ä¸ºä¸å…¶ä»–æ‰€æœ‰å¯¹è±¡å’Œå‡½æ•°ä¸åŒã€‚å³ä½¿ä»–ä»¬çš„å€¼ç›¸åŒä¹Ÿæ²¡å…³ç³»ï¼è§£å†³æ–¹æ³•
  - å°†é™æ€å¯¹è±¡å’Œå‡½æ•°ç§»å‡ºç»„ä»¶
  - å°†åŠ¨æ€å¯¹è±¡å’Œå‡½æ•°ç§»åŠ¨åˆ° Effect ä¸­

### ä½¿ç”¨è‡ªå®šä¹‰ Hook

React æœ‰ä¸€äº›å†…ç½® Hookï¼Œä¾‹å¦‚ useStateï¼ŒuseContext å’Œ useEffectã€‚æœ‰æ—¶ä½ éœ€è¦ä¸€ä¸ªç”¨é€”æ›´ç‰¹æ®Šçš„ Hookï¼šä¾‹å¦‚è·å–æ•°æ®ï¼Œè®°å½•ç”¨æˆ·æ˜¯å¦åœ¨çº¿æˆ–è€…è¿æ¥èŠå¤©å®¤ã€‚è™½ç„¶ React ä¸­å¯èƒ½æ²¡æœ‰è¿™äº› Hookï¼Œä½†æ˜¯ä½ å¯ä»¥æ ¹æ®åº”ç”¨éœ€æ±‚åˆ›å»ºè‡ªå·±çš„ Hookã€‚

- è‡ªå®šä¹‰ Hook è®©ä½ å¯ä»¥åœ¨ç»„ä»¶é—´å…±äº«é€»è¾‘ã€‚
- è‡ªå®šä¹‰ Hook å‘½åå¿…é¡»ä»¥åè·Ÿä¸€ä¸ªå¤§å†™å­—æ¯çš„ use å¼€å¤´ã€‚
- è‡ªå®šä¹‰ Hook å…±äº«çš„åªæ˜¯çŠ¶æ€é€»è¾‘ï¼Œä¸æ˜¯çŠ¶æ€æœ¬èº«ã€‚
- ä½ å¯ä»¥å°†å“åº”å€¼ä»ä¸€ä¸ª Hook ä¼ åˆ°å¦ä¸€ä¸ªï¼Œå¹¶ä¸”ä»–ä»¬ä¼šä¿æŒæœ€æ–°ã€‚
- æ¯æ¬¡ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œæ‰€æœ‰çš„ Hook ä¼šé‡æ–°è¿è¡Œã€‚
- è‡ªå®šä¹‰ Hook çš„ä»£ç åº”è¯¥å’Œç»„ä»¶ä»£ç ä¸€æ ·ä¿æŒçº¯ç²¹ã€‚
- æŠŠè‡ªå®šä¹‰ Hook æ”¶åˆ°çš„äº‹ä»¶å¤„ç†å‡½æ•°åŒ…è£¹åˆ° Effect Eventã€‚
- ä¸è¦åˆ›å»ºåƒ useMount è¿™æ ·çš„è‡ªå®šä¹‰ Hookã€‚ä¿æŒç›®æ ‡å…·ä½“åŒ–ã€‚
- å¦‚ä½•ä»¥åŠåœ¨å“ªé‡Œé€‰æ‹©ä»£ç è¾¹ç•Œå–å†³äºä½ ã€‚

```jsx
function useFadeIn(ref, duration) {
  const [isRunning, setIsRunning] = useState(false)

  useAnimationLoop(isRunning, timePassed => {
    const progress = Math.min(timePassed / duration, 1)
    ref.current.style.opacity = progress
    if (progress === 1) {
      setIsRunning(false)
    }
  })
}
function useAnimationLoop(isRunning, drawFrame) {
  const onFrame = useEffectEvent(drawFrame)
  useEffect(() => {
    if (!isRunning) {
      return
    }

    const startTime = performance.now()
    let frameId = null

    function tick(now) {
      const timePassed = now - startTime
      onFrame(timePassed)
      frameId = requestAnimationFrame(tick)
    }

    tick()

    return () => cancelAnimationFrame(frameId)
  }, [isRunning])
}
```
